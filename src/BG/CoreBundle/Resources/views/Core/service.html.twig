{% extends "BGCoreBundle::layout.html.twig" %}

{% block body %}

  {{ include('BGCoreBundle::menu.html.twig', { 'route' : 'BG_CoreBundle_view', 'parameters': {'id': id, 'sid': service.id} }) }}

  <div class="container-fluid card wizard-card" data-color="blue">

    <h2 class="row form-signin-heading justify-content-center">Édition des avancements</h2>

    <h3 class="row form-signin-heading justify-content-center">{{ service.level }} - {{ service.drawing }}</h2>

    {% if max.value != 100 %}
      <div>
        <a href="{{ path('BG_CoreBundle_addstate', {'id': id, "sid": service.id}) }}" class="btn btn-info">Ajouter un avancement</a>
        {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

        <div class="form-group">
          {{ form_label(form.value, "Pourcentage actuel", {'label_attr': {'class': 'control-label'}}) }}
          {{ form_errors(form.value) }}
          {{ form_widget(form.value, {'attr': {'class': 'form-control', 'min': max.value, 'max': 100}}) }}
        </div>

        {{ form_widget(form.save, {'attr': {'class': 'btn btn-success'}}) }}

        {{ form_rest(form) }}
        {{ form_end(form) }}
      </div>

      {% else %}
        <h2>Plan terminée à 100% !</h2>
    {% endif %}

    <h3 class="row form-signin-heading justify-content-center">Historique</h3>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Pourcentage</th>
          <th></th>
        </tr>
      </thead>
    <tbody>

      {% for state in service.states %}
        <tr>
          <td>{{ state.date|date('d-m-Y à H:i:s') }}</td>
          <td>{{ state.value }}</td>
          <td><a href="{{ path('BG_CoreBundle_removestate', {'id': id, 'sid': service.id, 'aid': state.id}) }}"><i class="fas fa-times" aria-hidden="true"></i></a></td>
        </tr>
      {% endfor %}

    </tbody>
    </table>

  </div>

  {{ parent() }}

{% endblock %}
